<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Questionário de Segurança Viária - ONSV</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary-color: #007bff; --background-light: #f4f7f6; --background-white: #ffffff; --text-dark: #343a40; --border-color: #e9ecef; --border-radius-lg: 12px; --border-radius-md: 8px; --box-shadow-light: 0 4px 12px rgba(0, 0, 0, 0.05); }
        body { font-family: 'Inter', sans-serif; background: var(--background-light); padding: 24px; display: flex; align-items: center; justify-content: center; }
        .container-principal { width: 100%; max-width: 1024px; background: var(--background-white); border-radius: var(--border-radius-lg); box-shadow: var(--box-shadow-light); overflow: hidden; }
        .progresso-header { background: var(--primary-color); color: #fff; padding: 20px 30px; }
        .progresso-header h2 { margin: 0; font-weight: 600; font-size: 1.6rem; text-align: center; }
        #autoavaliacao-form { padding: 30px; }
        .pergunta { margin: 25px 0; padding: 20px; border: 1px solid var(--border-color); border-radius: var(--border-radius-md); }
        .pergunta h4 { margin: 0 0 12px; font-size: 1.15rem; color: var(--text-dark); font-weight: 500; }
        .opcoes-resposta label { display: flex; gap: 12px; align-items: center; padding: 14px; border: 1px solid var(--border-color); border-radius: var(--border-radius-md); margin: 10px 0; cursor: pointer; }
        .opcoes-resposta input[type="radio"] { min-width: 18px; min-height: 18px; accent-color: var(--primary-color); }
        .btn-submit { width: 100%; padding: 14px 25px; border: none; border-radius: var(--border-radius-md); font-weight: 600; cursor: pointer; font-size: 1rem; background: var(--primary-color); color: #fff; margin-top: 30px; }
        .btn-submit:disabled { background: #6c757d; cursor: not-allowed; }
    </style>
</head>
<body>

<div class="container-principal">
    <header class="progresso-header">
        <h2>Autoavaliação de Segurança Viária</h2>
    </header>
    
    <form id="autoavaliacao-form" method="POST">
        <h1 class="text-2xl md:text-3xl font-bold text-center text-gray-800 mb-2">Questionário Pré-Ação</h1>
        <p class="text-center text-gray-600 mb-8">Teste seus conhecimentos sobre a segurança no trânsito no Brasil.</p>

        <div class="pergunta"><h4>1. Conhecendo a realidade...</h4><div class="opcoes-resposta"><label><input type="radio" name="q1" value="armas_fogo" required><span>Armas de Fogo</span></label><label><input type="radio" name="q1" value="transito"><span>Trânsito</span></label><label><input type="radio" name="q1" value="suicidio"><span>Suicídio</span></label></div></div>
        <div class="pergunta"><h4>2. Entre as crianças...</h4><div class="opcoes-resposta"><label><input type="radio" name="q2" value="doencas" required><span>Doenças transmissíveis</span></label><label><input type="radio" name="q2" value="afogamento"><span>Afogamento</span></label><label><input type="radio" name="q2" value="transito"><span>Trânsito</span></label></div></div>
        <div class="pergunta"><h4>3. Qual faixa etária...</h4><div class="opcoes-resposta"><label><input type="radio" name="q3" value="5-14" required><span>05 a 14 anos</span></label><label><input type="radio" name="q3" value="15-29"><span>15 a 29 anos</span></label><label><input type="radio" name="q3" value="60+"><span>60 anos ou mais</span></label></div></div>
        <div class="pergunta"><h4>4. No mundo, os sinistros...</h4><div class="opcoes-resposta"><label><input type="radio" name="q4" value="hiv" required><span>HIV/AIDS</span></label><label><input type="radio" name="q4" value="cancer"><span>Câncer infantil</span></label><label><input type="radio" name="q4" value="ambos"><span>Ambos</span></label></div></div>
        <div class="pergunta"><h4>5. Quem representa a maior parcela...</h4><div class="opcoes-resposta"><label><input type="radio" name="q5" value="pedestres" required><span>Pedestres</span></label><label><input type="radio" name="q5" value="ciclistas"><span>Ciclistas</span></label><label><input type="radio" name="q5" value="motociclistas"><span>Motociclistas</span></label></div></div>
        <div class="pergunta"><h4>6. Quanto o Brasil gasta...</h4><div class="opcoes-resposta"><label><input type="radio" name="q6" value="1-pib" required><span>Menos de 1%</span></label><label><input type="radio" name="q6" value="3-pib"><span>Cerca de 3%</span></label><label><input type="radio" name="q6" value="6-pib"><span>Cerca de 6%</span></label></div></div>
        <div class="pergunta"><h4>7. Qual fator está mais associado...</h4><div class="opcoes-resposta"><label><input type="radio" name="q7" value="velocidade" required><span>Excesso de velocidade</span></label><label><input type="radio" name="q7" value="cinto"><span>Falta de cinto de segurança</span></label><label><input type="radio" name="q7" value="defeito"><span>Defeito mecânico</span></label></div></div>
        <div class="pergunta"><h4>8. O uso de celular ao volante...</h4><div class="opcoes-resposta"><label><input type="radio" name="q8" value="50" required><span>50%</span></label><label><input type="radio" name="q8" value="100"><span>100%</span></label><label><input type="radio" name="q8" value="400-mais"><span>Mais de 400%</span></label></div></div>
        <div class="pergunta"><h4>9. Em uma colisão a 60 km/h...</h4><div class="opcoes-resposta"><label><input type="radio" name="q9" value="risco-passageiro" required><span>Só coloca em risco o passageiro sem cinto</span></label><label><input type="radio" name="q9" value="morte-frente"><span>Pode causar a morte de quem está na frente</span></label><label><input type="radio" name="q9" value="sem-diferenca"><span>Não faz diferença significativa</span></label></div></div>
        <div class="pergunta"><h4>10. Qual seria a medida mais eficaz...</h4><div class="opcoes-resposta"><label><input type="radio" name="q10" value="hospitais" required><span>Melhorar os hospitais para atender as vítimas</span></label><label><input type="radio" name="q10" value="investir"><span>Investir em fiscalização e prevenção</span></label><label><input type="radio" name="q10" value="reduzir-limites"><span>Reduzir os limites de velocidade apenas nas rodovias</span></label></div></div>
        <div class="pergunta"><h4>11. O que mais te preocupa...</h4><div><textarea name="respostaQ11" id="q11" rows="4" class="w-full p-3 border rounded-lg" placeholder="Digite sua resposta aqui..." required></textarea></div></div>

        <div id="hidden-fields"></div>

        <button type="submit" class="btn-submit">Enviar Respostas</button>
    </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const WEB_APP_URL = 'https://script.google.com/a/macros/onsv.org.br/s/AKfycbxoYs_PGBuofxe3JiQ-UOkQWvnOLlh8EmwTL769pmOsGP-O7UdZoWM0dvlqLnguh2dsvQ/exec';

    const form = document.getElementById('autoavaliacao-form');
    form.action = WEB_APP_URL; // Define o destino do formulário
    
    const correctAnswers = { q1: 'transito', q2: 'transito', q3: '15-29', q4: 'ambos', q5: 'motociclistas', q6: '3-pib', q7: 'velocidade', q8: '400-mais', q9: 'morte-frente', q10: 'investir' };
    
    form.addEventListener('submit', function(event) {
        event.preventDefault(); // Impede o envio imediato

        if (!form.checkValidity()) {
            alert('Por favor, responda a todas as perguntas para continuar.');
            return;
        }

        // Desabilita o botão para evitar envios duplicados
        form.querySelector('.btn-submit').disabled = true;
        form.querySelector('.btn-submit').textContent = 'Enviando...';
        
        // Calcula a pontuação
        let score = 0;
        Object.keys(correctAnswers).forEach(key => {
            const selected = form.querySelector(`input[name="${key}"]:checked`);
            if (selected && selected.value === correctAnswers[key]) score++;
        });
        
        // Pega os dados do participante da URL
        const urlParams = new URLSearchParams(window.location.search);
        
        // Cria os campos invisíveis com todos os dados necessários
        const hiddenFieldsContainer = document.getElementById('hidden-fields');
        const dadosParaEnviar = {
            questionarioTipo: 1,
            pontuacao: score,
            nome: urlParams.get('nome') || '',
            cpf: urlParams.get('cpf') || '',
            email: urlParams.get('email') || '',
            cidade: urlParams.get('cidade') || '',
            estado: urlParams.get('estado') || '',
            van: urlParams.get('van') || ''
        };

        for (const key in dadosParaEnviar) {
            const input = document.createElement('input');
            input.type = 'hidden';
            input.name = key;
            input.value = dadosParaEnviar[key];
            hiddenFieldsContainer.appendChild(input);
        }

        // Agora, envia o formulário de verdade
        form.submit();
    });
});
</script>

</body>
</html>
