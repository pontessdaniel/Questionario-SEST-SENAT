<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Questionário de Segurança Viária - ONSV</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary-color: #007bff; --background-light: #f4f7f6; --background-white: #ffffff; --text-dark: #343a40; --border-color: #e9ecef; --border-radius-lg: 12px; --border-radius-md: 8px; --box-shadow-light: 0 4px 12px rgba(0, 0, 0, 0.05); }
        body { font-family: 'Inter', sans-serif; background: var(--background-light); padding: 24px; display: flex; align-items: center; justify-content: center; }
        .container-principal { width: 100%; max-width: 1024px; background: var(--background-white); border-radius: var(--border-radius-lg); box-shadow: var(--box-shadow-light); overflow: hidden; }
        .progresso-header { background: var(--primary-color); color: #fff; padding: 20px 30px; }
        .progresso-header h2 { margin: 0; font-weight: 600; font-size: 1.6rem; text-align: center; }
        #autoavaliacao-form { padding: 30px; }
        .pergunta { margin: 25px 0; padding: 20px; border: 1px solid var(--border-color); border-radius: var(--border-radius-md); }
        .pergunta h4 { margin: 0 0 12px; font-size: 1.15rem; color: var(--text-dark); font-weight: 500; }
        .opcoes-resposta label { display: flex; gap: 12px; align-items: center; padding: 14px; border: 1px solid var(--border-color); border-radius: var(--border-radius-md); margin: 10px 0; cursor: pointer; }
        .opcoes-resposta input[type="radio"] { min-width: 18px; min-height: 18px; accent-color: var(--primary-color); }
        .btn-submit { width: 100%; padding: 14px 25px; border: none; border-radius: var(--border-radius-md); font-weight: 600; cursor: pointer; font-size: 1rem; background: var(--primary-color); color: #fff; margin-top: 30px; }
        .btn-submit:disabled { background: #6c757d; cursor: not-allowed; }
    </style>
</head>
<body>

<div class="container-principal">
    <div id="questionario-wrapper">
        <header class="progresso-header">
            <h2>Autoavaliação de Segurança Viária</h2>
        </header>
        <form id="autoavaliacao-form">
            <h1 class="text-2xl md:text-3xl font-bold text-center text-gray-800 mb-2">Questionário Pré-Ação</h1>
            <p class="text-center text-gray-600 mb-8">Teste seus conhecimentos sobre a segurança no trânsito no Brasil.</p>
            <div class="pergunta"><h4>1. Conhecendo a realidade...</h4><div class="opcoes-resposta"><label><input type="radio" name="q1" value="armas_fogo" required><span>...</span></label>...</div></div>
            <div class="pergunta"><h4>2. Entre as crianças...</h4><div class="opcoes-resposta"><label><input type="radio" name="q2" value="doencas" required><span>...</span></label>...</div></div>
            <div class="pergunta"><h4>3. Qual faixa etária...</h4><div class="opcoes-resposta"><label><input type="radio" name="q3" value="5-14" required><span>...</span></label>...</div></div>
            <div class="pergunta"><h4>4. No mundo, os sinistros...</h4><div class="opcoes-resposta"><label><input type="radio" name="q4" value="hiv" required><span>...</span></label>...</div></div>
            <div class="pergunta"><h4>5. Quem representa...</h4><div class="opcoes-resposta"><label><input type="radio" name="q5" value="pedestres" required><span>...</span></label>...</div></div>
            <div class="pergunta"><h4>6. Quanto o Brasil gasta...</h4><div class="opcoes-resposta"><label><input type="radio" name="q6" value="1-pib" required><span>...</span></label>...</div></div>
            <div class="pergunta"><h4>7. Qual fator está...</h4><div class="opcoes-resposta"><label><input type="radio" name="q7" value="velocidade" required><span>...</span></label>...</div></div>
            <div class="pergunta"><h4>8. O uso de celular...</h4><div class="opcoes-resposta"><label><input type="radio" name="q8" value="50" required><span>...</span></label>...</div></div>
            <div class="pergunta"><h4>9. Em uma colisão...</h4><div class="opcoes-resposta"><label><input type="radio" name="q9" value="risco-passageiro" required><span>...</span></label>...</div></div>
            <div class="pergunta"><h4>10. Qual seria a medida...</h4><div class="opcoes-resposta"><label><input type="radio" name="q10" value="hospitais" required><span>...</span></label>...</div></div>
            <div class="pergunta"><h4>11. O que mais te preocupa...</h4><div><textarea name="respostaQ11" id="q11" rows="4" class="w-full p-3 border rounded-lg" required></textarea></div></div>
            <button type="submit" class="btn-submit">Enviar Respostas</button>
        </form>
    </div>

    <div id="agradecimento-wrapper" style="display: none; text-align: center; padding: 40px;">
        <h1 class="text-3xl font-bold text-gray-800">Obrigado por participar!</h1>
        <p class="text-lg text-gray-600 mt-2">Suas respostas foram registradas com sucesso.</p>
        <div style='margin-top: 30px; padding: 20px; border: 1px solid #ddd; border-radius: 8px; background-color: #f9f9f9; display: inline-block;'>
            <p style='margin: 0; font-size: 1.2em;'>Sua pontuação final foi:</p>
            <h2 id="pontuacao-final" style='margin: 10px 0; font-size: 3em; color: #007bff;'></h2>
        </div>
        <br>
        <button onclick="window.location.href='index.html'" class="btn-submit" style="max-width: 300px; margin: 30px auto 0;">Voltar ao Início</button>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const WEB_APP_URL = 'COLE_A_SUA_URL_COMPLETA_AQUI';

    const form = document.getElementById('autoavaliacao-form');
    const questionarioWrapper = document.getElementById('questionario-wrapper');
    const agradecimentoWrapper = document.getElementById('agradecimento-wrapper');
    const pontuacaoFinalEl = document.getElementById('pontuacao-final');
    
    const correctAnswers = { q1: 'transito', q2: 'transito', q3: '15-29', q4: 'ambos', q5: 'motociclistas', q6: '3-pib', q7: 'velocidade', q8: '400-mais', q9: 'morte-frente', q10: 'investir' };
    
    form.addEventListener('submit', async function(event) {
        event.preventDefault();

        if (!form.checkValidity()) {
            alert('Por favor, responda a todas as perguntas para continuar.');
            return;
        }

        const submitButton = form.querySelector('.btn-submit');
        const originalButtonText = submitButton.textContent;
        submitButton.disabled = true;
        submitButton.textContent = 'Enviando...';
        
        let score = 0;
        Object.keys(correctAnswers).forEach(key => {
            const selected = form.querySelector(`input[name="${key}"]:checked`);
            if (selected && selected.value === correctAnswers[key]) score++;
        });
        
        const urlParams = new URLSearchParams(window.location.search);
        
        const dataToSend = {
            action: 'save_data', // Ação para o Apps Script saber o que fazer
            questionarioTipo: 1,
            pontuacao: score,
            nome: urlParams.get('nome') || '',
            cpf: urlParams.get('cpf') || '',
            email: urlParams.get('email') || '',
            cidade: urlParams.get('cidade') || '',
            estado: urlParams.get('estado') || '',
            van: urlParams.get('van') || '',
            respostaQ11: document.getElementById('q11').value
        };

        try {
            const response = await fetch(WEB_APP_URL, {
                method: 'POST',
                cache: 'no-cache',
                headers: { 'Content-Type': 'application/json' },
                redirect: 'follow',
                body: JSON.stringify(dataToSend)
            });

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            
            // Se o envio foi bem-sucedido, mostra a tela de agradecimento
            pontuacaoFinalEl.textContent = `${score} / 10`;
            questionarioWrapper.style.display = 'none';
            agradecimentoWrapper.style.display = 'block';

        } catch (error) {
            console.error('Erro ao enviar os dados:', error);
            alert('Ocorreu um erro ao enviar suas respostas. Por favor, tente novamente.');
            submitButton.disabled = false;
            submitButton.textContent = originalButtonText;
        }
    });
});
</script>

</body>
</html>
