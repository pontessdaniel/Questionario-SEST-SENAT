<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Questionário de Segurança Viária - ONSV</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary-color: #007bff; --background-light: #f4f7f6; --background-white: #ffffff; --text-dark: #343a40; --border-color: #e9ecef; --border-radius-lg: 12px; --border-radius-md: 8px; --box-shadow-light: 0 4px 12px rgba(0, 0, 0, 0.05); }
        body { font-family: 'Inter', sans-serif; background: var(--background-light); padding: 24px; display: flex; align-items: center; justify-content: center; }
        .container-principal { width: 100%; max-width: 1024px; background: var(--background-white); border-radius: var(--border-radius-lg); box-shadow: var(--box-shadow-light); overflow: hidden; }
        .progresso-header { background: var(--primary-color); color: #fff; padding: 20px 30px; }
        .progresso-header h2 { margin: 0; font-weight: 600; font-size: 1.6rem; text-align: center; }
        #autoavaliacao-form { padding: 30px; }
        .pergunta { margin: 25px 0; padding: 20px; border: 1px solid var(--border-color); border-radius: var(--border-radius-md); }
        .pergunta h4 { margin: 0 0 12px; font-size: 1.15rem; color: var(--text-dark); font-weight: 500; }
        .opcoes-resposta label { display: flex; gap: 12px; align-items: center; padding: 14px; border: 1px solid var(--border-color); border-radius: var(--border-radius-md); margin: 10px 0; cursor: pointer; }
        .opcoes-resposta input[type="radio"] { min-width: 18px; min-height: 18px; accent-color: var(--primary-color); }
        .btn-submit { width: 100%; padding: 14px 25px; border: none; border-radius: var(--border-radius-md); font-weight: 600; cursor: pointer; font-size: 1rem; background: var(--primary-color); color: #fff; margin-top: 30px; }
        .btn-submit:disabled { background: #6c757d; cursor: not-allowed; }
    </style>
</head>
<body>

<div class="container-principal">
    <div id="questionario-wrapper">
        <header class="progresso-header">
            <h2>Autoavaliação de Segurança Viária</h2>
        </header>
        <form id="autoavaliacao-form">
            <h1 class="text-2xl md:text-3xl font-bold text-center text-gray-800 mb-2">Questionário Pré-Ação</h1>
            <p class="text-center text-gray-600 mb-8">Teste seus conhecimentos sobre a segurança no trânsito no Brasil.</p>

            <div class="pergunta" data-question="q1">
                <h4 class="font-semibold text-lg text-gray-700 mb-3">1. Conhecendo a realidade brasileira, o que você acha que mata mais no Brasil?</h4>
                <div class="opcoes-resposta space-y-2">
                    <label><input type="radio" name="q1" value="armas_fogo" required><span>Armas de Fogo</span></label>
                    <label><input type="radio" name="q1" value="transito"><span>Trânsito</span></label>
                    <label><input type="radio" name="q1" value="suicidio"><span>Suicídio</span></label>
                </div>
            </div>

            <div class="pergunta" data-question="q2">
                <h4 class="font-semibold text-lg text-gray-700 mb-3">2. Entre as crianças de 05 a 14 anos, qual é a principal causa de morte?</h4>
                <div class="opcoes-resposta space-y-2">
                    <label><input type="radio" name="q2" value="doencas" required><span>Doenças transmissíveis</span></label>
                    <label><input type="radio" name="q2" value="afogamento"><span>Afogamento</span></label>
                    <label><input type="radio" name="q2" value="transito"><span>Trânsito</span></label>
                </div>
            </div>
            
            <div class="pergunta" data-question="q3">
                <h4 class="font-semibold text-lg text-gray-700 mb-3">3. Qual faixa etária mais morre em sinistros de trânsito no Brasil?</h4>
                <div class="opcoes-resposta space-y-2">
                    <label><input type="radio" name="q3" value="5-14" required><span>05 a 14 anos</span></label>
                    <label><input type="radio" name="q3" value="15-29"><span>15 a 29 anos</span></label>
                    <label><input type="radio" name="q3" value="60+"><span>60 anos ou mais</span></label>
                </div>
            </div>

            <div class="pergunta" data-question="q4">
                <h4 class="font-semibold text-lg text-gray-700 mb-3">4. No mundo, os sinistros de trânsito matam mais do que:</h4>
                <div class="opcoes-resposta space-y-2">
                    <label><input type="radio" name="q4" value="hiv" required><span>HIV/AIDS</span></label>
                    <label><input type="radio" name="q4" value="cancer"><span>Câncer infantil</span></label>
                    <label><input type="radio" name="q4" value="ambos"><span>Ambos</span></label>
                </div>
            </div>

            <div class="pergunta" data-question="q5">
                <h4 class="font-semibold text-lg text-gray-700 mb-3">5. Quem representa a maior parcela das vítimas fatais no trânsito brasileiro?</h4>
                <div class="opcoes-resposta space-y-2">
                    <label><input type="radio" name="q5" value="pedestres" required><span>Pedestres</span></label>
                    <label><input type="radio" name="q5" value="ciclistas"><span>Ciclistas</span></label>
                    <label><input type="radio" name="q5" value="motociclistas"><span>Motociclistas</span></label>
                </div>
            </div>

            <div class="pergunta" data-question="q6">
                <h4 class="font-semibold text-lg text-gray-700 mb-3">6. Quanto o Brasil gasta, em média, com os sinistros de trânsito em relação ao PIB?</h4>
                <div class="opcoes-resposta space-y-2">
                    <label><input type="radio" name="q6" value="1-pib" required><span>Menos de 1%</span></label>
                    <label><input type="radio" name="q6" value="3-pib"><span>Cerca de 3%</span></label>
                    <label><input type="radio" name="q6" value="6-pib"><span>Cerca de 6%</span></label>
                </div>
            </div>

            <div class="pergunta" data-question="q7">
                <h4 class="font-semibold text-lg text-gray-700 mb-3">7. Qual fator está mais associado à gravidade dos sinistros?</h4>
                <div class="opcoes-resposta space-y-2">
                    <label><input type="radio" name="q7" value="velocidade" required><span>Excesso de velocidade</span></label>
                    <label><input type="radio" name="q7" value="cinto"><span>Falta de cinto de segurança</span></label>
                    <label><input type="radio" name="q7" value="defeito"><span>Defeito mecânico</span></label>
                </div>
            </div>

            <div class="pergunta" data-question="q8">
                <h4 class="font-semibold text-lg text-gray-700 mb-3">8. O uso de celular ao volante aumenta o risco de sinistros em:</h4>
                <div class="opcoes-resposta space-y-2">
                    <label><input type="radio" name="q8" value="50" required><span>50%</span></label>
                    <label><input type="radio" name="q8" value="100"><span>100%</span></label>
                    <label><input type="radio" name="q8" value="400-mais"><span>Mais de 400%</span></label>
                </div>
            </div>

            <div class="pergunta" data-question="q9">
                 <h4 class="font-semibold text-lg text-gray-700 mb-3">9. Em uma colisão a 60 km/h, não usar cinto de segurança no banco traseiro:</h4>
                <div class="opcoes-resposta space-y-2">
                    <label><input type="radio" name="q9" value="risco-passageiro" required><span>Só coloca em risco o passageiro sem cinto</span></label>
                    <label><input type="radio" name="q9" value="morte-frente"><span>Pode causar a morte de quem está na frente</span></label>
                    <label><input type="radio" name="q9" value="sem-diferenca"><span>Não faz diferença significativa</span></label>
                </div>
            </div>

            <div class="pergunta" data-question="q10">
                <h4 class="font-semibold text-lg text-gray-700 mb-3">10. Qual seria a medida mais eficaz para reduzir mortes no trânsito?</h4>
                <div class="opcoes-resposta space-y-2">
                    <label><input type="radio" name="q10" value="hospitais" required><span>Melhorar os hospitais para atender as vítimas</span></label>
                    <label><input type="radio" name="q10" value="investir"><span>Investir em fiscalização e prevenção</span></label>
                    <label><input type="radio" name="q10" value="reduzir-limites"><span>Reduzir os limites de velocidade apenas nas rodovias</span></label>
                </div>
            </div>

            <div class="pergunta">
                <h4 class="font-semibold text-lg text-gray-700 mb-3">11. O que mais te preocupa quando pensa em segurança no trânsito?</h4>
                <div><textarea name="respostaQ11" id="q11" rows="4" class="w-full p-3 border rounded-lg" required></textarea></div>
            </div>
            <button type="submit" class="btn-submit">Enviar Respostas</button>
        </form>
    </div>

    <div id="agradecimento-wrapper" style="display: none; text-align: center; padding: 40px;">
        <h1 class="text-3xl font-bold text-gray-800">Obrigado por participar!</h1>
        <p class="text-lg text-gray-600 mt-2">Suas respostas foram registradas com sucesso.</p>
        <div style='margin-top: 30px; padding: 20px; border: 1px solid #ddd; border-radius: 8px; background-color: #f9f9f9; display: inline-block;'>
            <p style='margin: 0; font-size: 1.2em;'>Sua pontuação final foi:</p>
            <h2 id="pontuacao-final" style='margin: 10px 0; font-size: 3em; color: #007bff;'></h2>
        </div>
        <br>
        <button onclick="window.location.href='index.html'" class="btn-submit" style="max-width: 300px; margin: 30px auto 0;">Voltar ao Início</button>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // COLE AQUI A SUA URL DO WEB APP (A QUE TERMINA COM /exec)
    const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbzR8Fe6Vl0Xgxfito_Wtr3LM-iOziFvnM0Sx_vewvowvayIQMHOamqx5L_aF8uMacTyrQ/exec';

    const form = document.getElementById('autoavaliacao-form');
    const questionarioWrapper = document.getElementById('questionario-wrapper');
    const agradecimentoWrapper = document.getElementById('agradecimento-wrapper');
    const pontuacaoFinalEl = document.getElementById('pontuacao-final');
    
    // GABARITO PARA O QUESTIONÁRIO 1
    const correctAnswers = { q1: 'transito', q2: 'transito', q3: '15-29', q4: 'ambos', q5: 'motociclistas', q6: '3-pib', q7: 'velocidade', q8: '400-mais', q9: 'morte-frente', q10: 'investir' };
    
    form.addEventListener('submit', async function(event) {
        event.preventDefault();

        if (!form.checkValidity()) {
            alert('Por favor, responda a todas as perguntas para continuar.');
            return;
        }

        const submitButton = form.querySelector('.btn-submit');
        const originalButtonText = submitButton.textContent;
        submitButton.disabled = true;
        submitButton.textContent = 'Enviando...';
        
        let score = 0;
        Object.keys(correctAnswers).forEach(key => {
            const selected = form.querySelector(`input[name="${key}"]:checked`);
            if (selected && selected.value === correctAnswers[key]) score++;
        });
        
        const urlParams = new URLSearchParams(window.location.search);
        
        const dataToSend = {
            action: 'save_data',
            questionarioTipo: 1,
            pontuacao: score,
            nome: urlParams.get('nome') || '',
            cpf: urlParams.get('cpf') || '',
            email: urlParams.get('email') || '',
            cidade: urlParams.get('cidade') || '',
            estado: urlParams.get('estado') || '',
            van: urlParams.get('van') || '',
            respostaQ11: document.getElementById('q11').value
        };

        try {
            const response = await fetch(WEB_APP_URL, {
                method: 'POST',
                cache: 'no-cache',
                headers: { 'Content-Type': 'application/json' },
                redirect: 'follow',
                body: JSON.stringify(dataToSend)
            });

            if (!response.ok) {
                // Mesmo que a resposta não seja 'ok', não queremos travar o usuário
                console.error(`HTTP error! status: ${response.status}`);
            }
            
            // Independentemente do sucesso do envio, mostra a tela de agradecimento
            pontuacaoFinalEl.textContent = `${score} / 10`;
            questionarioWrapper.style.display = 'none';
            agradecimentoWrapper.style.display = 'block';

        } catch (error) {
            console.error('Erro de rede ao enviar os dados:', error);
            // Mesmo com erro de rede, ainda mostra a tela de agradecimento
            pontuacaoFinalEl.textContent = `${score} / 10`;
            questionarioWrapper.style.display = 'none';
            agradecimentoWrapper.style.display = 'block';
        }
    });
});
</script>

</body>
</html>
